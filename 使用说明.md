# 来龙去脉事件追踪器 - 使用说明

## 项目概述

"来龙去脉"事件追踪器是一个帮助用户高效追踪事件完整过程及后续动态的Web应用。通过输入事件名称，系统会自动搜索相关新闻，分析事件要素，并提供完整的时间线信息。

## 功能特性

### 1. 事件信息查询
- 输入事件名称，自动搜索相关新闻
- 智能分析事件要素（核心人物、起因、经过、结果等）
- 生成完整的事件时间线
- 实时显示相关新闻列表

### 2. 用户系统
- 手机号注册登录
- 短信验证码验证（模拟实现）
- 用户信息管理

### 3. 收藏功能
- 登录用户可收藏感兴趣的事件
- 收藏列表管理
- 手动刷新事件进展
- 自动定时更新（每日上午6点）

## 技术架构

### 后端技术栈
- **Python 3.8+** - 主要编程语言
- **Flask 2.3+** - Web框架
- **SQLite** - 数据库
- **扣子(coze)工作流API** - 事件分析服务
- **APScheduler** - 定时任务调度

### 前端技术栈
- **Vue 3** - 前端框架
- **Element Plus** - UI组件库
- **Vue Router** - 路由管理
- **Pinia** - 状态管理
- **Axios** - HTTP客户端

## 快速开始

### 环境要求
- Python 3.8 或更高版本
- Node.js 16 或更高版本
- npm 或 yarn 包管理器

### 自动启动（推荐）

#### Windows 用户
1. 双击运行 `start.bat` 文件
2. 等待服务启动完成
3. 浏览器访问 http://localhost:3000

#### Linux/Mac 用户
1. 给启动脚本执行权限：
   ```bash
   chmod +x start.sh
   ```
2. 运行启动脚本：
   ```bash
   ./start.sh
   ```
3. 浏览器访问 http://localhost:3000

### 手动启动

#### 1. 启动后端服务
```bash
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
python app.py
```

#### 2. 启动前端服务
```bash
cd frontend
npm install
npm run dev
```

#### 3. 访问应用
- 前端地址：http://localhost:3000
- 后端API：http://localhost:5000

## 使用指南

### 1. 用户注册/登录
1. 点击右上角"用户"菜单
2. 输入手机号（支持中国大陆手机号格式）
3. 点击"发送验证码"获取6位验证码
4. 输入验证码后点击"注册"或"登录"

### 2. 搜索事件
1. 在首页搜索框中输入事件名称
2. 点击"搜索"按钮或按回车键
3. 系统会自动：
   - 优化事件名称
   - 搜索相关新闻
   - 分析事件要素
   - 生成时间线

### 3. 收藏事件
1. 在搜索结果页面点击"收藏事件"按钮
2. 收藏的事件会出现在"收藏"页面
3. 可以随时查看和管理收藏的事件

### 4. 管理收藏
1. 点击"收藏"菜单进入收藏页面
2. 左侧显示收藏列表，右侧显示事件详情
3. 可以：
   - 点击事件名称查看详情
   - 点击"刷新进展"获取最新信息
   - 点击"全部刷新"更新所有收藏
   - 点击删除按钮移除收藏

## API 接口说明

### 事件相关接口

#### 搜索事件
```
POST /api/events/search
Content-Type: application/json

{
  "input": "事件名称"
}
```

#### 分析事件
```
POST /api/events/analyze
Content-Type: application/json

{
  "event_name": "事件名称",
  "news_list": ["新闻1", "新闻2", ...]
}
```

#### 获取新闻
```
POST /api/events/news
Content-Type: application/json

{
  "event_name": "事件名称"
}
```

### 用户认证接口

#### 发送验证码
```
POST /api/auth/send-code
Content-Type: application/json

{
  "phone": "手机号"
}
```

#### 用户注册
```
POST /api/auth/register
Content-Type: application/json

{
  "phone": "手机号",
  "code": "验证码"
}
```

#### 用户登录
```
POST /api/auth/login
Content-Type: application/json

{
  "phone": "手机号",
  "code": "验证码"
}
```

### 收藏功能接口

#### 获取收藏列表
```
GET /api/favorites
```

#### 添加收藏
```
POST /api/favorites
Content-Type: application/json

{
  "event_name": "事件名称",
  "key_men": "核心人物",
  "event_overview": "事件总览",
  "key_point": "关键讨论点",
  "latest": "最新进展",
  "event_cause": "事件起因",
  "event_process": "事件经过",
  "event_result": "事件结果",
  "timeline": [...]
}
```

#### 删除收藏
```
DELETE /api/favorites/{id}
```

#### 刷新事件进展
```
POST /api/favorites/{id}/refresh
```

## 配置说明

### 后端配置
配置文件：`backend/config.py`

主要配置项：
- `COZE_TOKEN` - 扣子平台访问令牌
- `WORKFLOW_IDS` - 工作流ID配置
- `SMS_CODE_EXPIRE_MINUTES` - 验证码过期时间
- `CORS_ORIGINS` - 跨域配置

### 前端配置
配置文件：`frontend/vite.config.js`

主要配置项：
- 开发服务器端口：3000
- API代理配置：代理到后端5000端口

## 数据库结构

### 用户表 (users)
- `id` - 用户ID
- `phone` - 手机号
- `created_at` - 创建时间
- `updated_at` - 更新时间

### 验证码表 (verification_codes)
- `id` - 验证码ID
- `phone` - 手机号
- `code` - 验证码
- `created_at` - 创建时间
- `expires_at` - 过期时间
- `used` - 是否已使用

### 收藏表 (favorites)
- `id` - 收藏ID
- `user_id` - 用户ID
- `event_name` - 事件名称
- `key_men` - 核心人物
- `event_overview` - 事件总览
- `key_point` - 关键讨论点
- `latest` - 最新进展
- `event_cause` - 事件起因
- `event_process` - 事件经过
- `event_result` - 事件结果
- `timeline` - 时间线（JSON格式）
- `created_at` - 创建时间
- `updated_at` - 更新时间
- `last_refresh` - 最后刷新时间

## 定时任务

系统配置了定时任务，每日上午6点自动刷新所有收藏事件的最新进展。

## 故障排除

### 常见问题

1. **后端启动失败**
   - 检查Python版本是否为3.8+
   - 确认虚拟环境已正确创建
   - 检查依赖包是否安装完整

2. **前端启动失败**
   - 检查Node.js版本是否为16+
   - 确认npm依赖已安装
   - 检查端口3000是否被占用

3. **API调用失败**
   - 确认后端服务已启动
   - 检查网络连接
   - 查看浏览器控制台错误信息

4. **扣子平台API调用失败**
   - 检查token是否有效
   - 确认网络连接正常
   - 查看后端日志错误信息

### 日志查看

- 后端日志：在终端中查看Flask应用输出
- 前端日志：在浏览器开发者工具中查看

## 开发说明

### 项目结构
```
EventTrail/
├── backend/                 # 后端Flask应用
│   ├── app.py              # Flask主应用
│   ├── config.py           # 配置文件
│   ├── models.py           # 数据模型
│   ├── routes/             # 路由模块
│   ├── services/           # 业务逻辑服务
│   ├── utils/              # 工具函数
│   └── requirements.txt    # Python依赖
├── frontend/               # 前端Vue3应用
│   ├── src/
│   │   ├── components/     # Vue组件
│   │   ├── views/          # 页面视图
│   │   ├── router/         # 路由配置
│   │   ├── stores/         # 状态管理
│   │   ├── utils/          # 工具函数
│   │   ├── App.vue         # 根组件
│   │   └── main.js         # 入口文件
│   ├── package.json        # Node.js依赖
│   └── vite.config.js      # Vite配置
└── docs/                   # 项目文档
```

### 开发环境设置

1. **后端开发**
   ```bash
   cd backend
   python -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   python app.py
   ```

2. **前端开发**
   ```bash
   cd frontend
   npm install
   npm run dev
   ```

### 代码规范

- 后端：遵循PEP 8 Python代码规范
- 前端：使用ESLint和Prettier进行代码格式化
- 提交信息：使用清晰的提交信息描述变更

## 部署说明

### 生产环境部署

1. **后端部署**
   - 使用Gunicorn或uWSGI作为WSGI服务器
   - 配置Nginx作为反向代理
   - 使用PostgreSQL或MySQL替代SQLite

2. **前端部署**
   - 构建生产版本：`npm run build`
   - 部署到静态文件服务器
   - 配置CDN加速

3. **环境变量配置**
   - 设置生产环境配置
   - 配置数据库连接
   - 设置日志级别

## 更新日志

### v1.0.0 (2024-01-01)
- 初始版本发布
- 实现基础事件搜索和分析功能
- 实现用户注册登录系统
- 实现收藏功能
- 实现定时任务更新

## 技术支持

如有问题或建议，请通过以下方式联系：

- 项目地址：[GitHub仓库地址]
- 问题反馈：[Issues页面]
- 邮箱：[联系邮箱]

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。 